substitutions:
  name: test_hm_hms

esphome:
  name: ${name}

  platformio_options:  
     build_unflags:
      - -Werror=all
     build_flags:
      -DBOARD_HAS_PSRAM
      # -DPIN_MAPPING_REQUIRED=1
        
esp32:
  board: esp32dev
  cpu_frequency: 240Mhz
  framework:
    type: arduino # platformio/espressif32@5.4.0)
    # version: 3.0.4  ##  ~3.20005.0
    # platform_version: 53.3.13
   
external_components:
  - source: "github://SeByDocKy/myESPhome/"
    components: [hm_hms_inverter]
    refresh: 0s
            
logger:
  level: debug

# Enable Home Assistant API
api:
  batch_delay: 50ms

ota:
  - platform: esphome

time:
  - platform: sntp
    id: homeassistant_time

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "HM+HMS Hotspot"
    password: "eVt5yd7PvHjS"
    
        
hm_hms_inverter:
  id: hm_hms_id
  update_interval: '3s'
  pins:
    cmt_clk: GPIO18
    cmt_cs: GPIO21
    cmt_fcs: GPIO22
    cmt_sdio: GPIO19
    cmt_gpio2: GPIO27
    cmt_gpio3: GPIO32
    
    nrf_clk: GPIO26
    nrf_mosi: GPIO18
    nrf_miso: GPIO19
    nrf_cs: GPIO23
    nrf_en: GPIO22
    nrf_irq: GPIO21
    
packages: 

  hm_inverter1: 
    url: https://github.com/SeByDocKy/myESPhome/
    ref: main
    refresh: 0s
    files:
      - path: 'code/device_hm_2t.yaml' 
        vars:
          hm_inverter_id: 'hm_hms_id'
          hm_inverter_name: 'hm1_1500'
          hm_inverter_sn: !secret hm1500_sn1

  # hm_inverter2: 
    # url: https://github.com/SeByDocKy/myESPhome/
    # ref: main
    # refresh: 0s
    # files:
      # - path: 'code/device_hm_4t.yaml' 
        # vars:
          # hm_inverter_id: 'hm_id'
          # hm_inverter_name: 'hms_2000'
          # hm_inverter_sn: !secret hm2000_sn1
